BootStrap: docker-daemon
From: condaforge/miniforge3:24.11.3-2

%files
    scripts/utils.R /mnt/utils.R
    scripts/scenic-0.1.R /mnt/scenic.R
%post
    cp /etc/apt/sources.list /etc/apt/sources.list.bak
    echo "deb http://mirrors.aliyun.com/ubuntu/ noble main restricted universe multiverse" > /etc/apt/sources.list
    echo "deb http://mirrors.aliyun.com/ubuntu/ noble-updates main restricted universe multiverse" >> /etc/apt/sources.list
    echo "deb http://mirrors.aliyun.com/ubuntu/ noble-security main restricted universe multiverse" >> /etc/apt/sources.list

    apt-get update -qq && apt-get install -y locales -qq
    locale-gen en_US.UTF-8
    update-locale LANG=en_US.UTF-8
    
    mamba create -n scenic conda-forge::r-arrow \
        r-tidyverse r-devtools \
        r-complexheatmap bioconda::bioconductor-rcistarget \
        conda-forge::r-magick \
        -c bioconda -c conda-forge \
        -y

    /opt/conda/envs/enricher/bin/Rscript --verbose /mnt/scenic.R

%environment
    export LANG=en_US.UTF-8
    export LC_ALL=en_US.UTF-8
    export OPENBLAS_NUM_THREADS=1
    export OMP_NUM_THREADS=1
    export PATH=/opt/conda/bin:$PATH
    export PATH=/opt/conda/envs/scenic/bin:$PATH