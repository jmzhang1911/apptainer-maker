BootStrap: docker-daemon
From: condaforge/miniforge3:25.11.0-0

%files
    ./data/raw_packages/cellranger-10.0.0.tar.gz /opt/cellranger-10.0.0.tar.gz
    ./data/raw_packages/cellranger-arc-2.1.0.tar.gz /opt/cellranger-arc-2.1.0.tar.gz

%post
    cp /etc/apt/sources.list /etc/apt/sources.list.bak
    echo "deb http://mirrors.aliyun.com/ubuntu/ noble main restricted universe multiverse" > /etc/apt/sources.list
    echo "deb http://mirrors.aliyun.com/ubuntu/ noble-updates main restricted universe multiverse" >> /etc/apt/sources.list
    echo "deb http://mirrors.aliyun.com/ubuntu/ noble-security main restricted universe multiverse" >> /etc/apt/sources.list

    cd /opt/
    tar -zxf cellranger-10.0.0.tar.gz
    tar -zxf /opt/cellranger-arc-2.1.0.tar.gz
    rm cellranger-*.tar.gz

    conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main
    conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free
    conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r
    conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge
    conda config --set show_channel_urls yes
    
    mamba create -n velocyto bioconda::velocyto.py samtools -y --quiet
    
%environment
    export LANG=en_US.UTF-8
    export LC_ALL=en_US.UTF-8
    export PATH=/opt/cellranger-10.0.0:$PATH
    export PATH=/opt/cellranger-arc-2.1.0:$PATH
    export PATH=/opt/conda/envs/velocyto/bin:$PATH

